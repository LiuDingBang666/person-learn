<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="icu.liuwisdom.admin.mapper.SysMenuMapper">

    <select id="selectMenusByUserId" resultType="icu.liuwisdom.admin.entity.SysMenu">
        select distinct sys_menu.id,
                        sys_menu.name,
                        sys_menu.parent_id,
                        sys_menu.url,
                        sys_menu.perms,
                        sys_menu.type,
                        sys_menu.icon,
                        sys_menu.order_num,
                        sys_menu.create_by,
                        sys_menu.create_time,
                        sys_menu.last_update_by,
                        sys_menu.last_update_time,
                        sys_menu.del_flag,
                        sys_menu.endpoint
        from sys_menu sys_menu
        where sys_menu.del_flag = 0 and sys_menu.id in (select sys_menu.id
                                                        from sys_menu sys_menu
                                                                 left join sys_role_menu sys_role_menu on sys_role_menu.menu_id = sys_menu.id
                                                                 left join sys_role sys_role on sys_role_menu.role_id = sys_role.id
                                                                 left join sys_user_role sys_user_role on sys_user_role.role_id = sys_role.id
                                                                 left join sys_user sys_user on sys_user.id = sys_user_role.user_id
                                                        where sys_user.id = #{userId})
           or sys_menu.endpoint = 1 and sys_menu.del_flag = 0
        order by sys_menu.order_num, sys_menu.last_update_time
                desc, sys_menu.create_time desc
    </select>
    <select id="pageData" resultType="icu.liuwisdom.admin.vo.SysMenuVo">
        select sys_menu.id,
        sys_menu.name,
        sys_menu.parent_id,
        sys_menu.url,
        sys_menu.perms,
        sys_menu.type,
        sys_menu.icon,
        sys_menu.order_num,
        sys_menu.create_by,
        sys_menu.create_time,
        sys_menu.last_update_by,
        sys_menu.last_update_time,
        sys_menu.del_flag,
        sys_menu.endpoint,
        sys_menu2.name 'parentName'
        from sys_menu sys_menu
        left join sys_menu sys_menu2 on sys_menu.parent_id = sys_menu2.id and sys_menu2.del_flag = 0
        where sys_menu.del_flag = 0 and sys_menu.type != 2
        <trim>
            <if test="name!=null and name!=''">
                and sys_menu.name like concat('%',#{name},'%')
            </if>
            <if test="url!=null and url!=''">
                and sys_menu.url like concat('%',#{url},'%')
            </if>
            <!--           <if test="type!=null">
                           and sys_menu.type=#{type}
                       </if>-->
            <if test="endpoint!=null">
                and sys_menu.endpoint=#{endpoint}
            </if>
        </trim>
        order by sys_menu.order_num, sys_menu.last_update_time desc, sys_menu.create_time desc
    </select>
</mapper>
