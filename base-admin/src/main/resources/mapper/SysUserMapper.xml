<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="icu.liuwisdom.admin.mapper.SysUserMapper">
    <sql id="select">
        select sys_user.id               sys_user_id,
               sys_user.name             sys_user_name,
               sys_user.nick_name        sys_user_nick_name,
               sys_user.avatar           sys_user_avatar,
               sys_user.password         sys_user_password,
               sys_user.salt             sys_user_salt,
               sys_user.email            sys_user_email,
               sys_user.mobile           sys_user_mobile,
               sys_user.status           sys_user_status,
               sys_user.dept_id          sys_user_dept_id,
               sys_user.create_by        sys_user_create_by,
               sys_user.create_time      sys_user_create_time,
               sys_user.last_update_by   sys_user_last_update_by,
               sys_user.last_update_time sys_user_last_update_time,
               sys_user.del_flag         sys_user_del_flag,
               sys_user.user_type        sys_user_user_type,
               sys_dept.id               sys_dept_id,
               sys_dept.name             sys_dept_name,
               sys_dept.parent_id        sys_dept_parent_id,
               sys_dept.order_num        sys_dept_order_num,
               sys_dept.create_by        sys_dept_create_by,
               sys_dept.create_time      sys_dept_create_time,
               sys_dept.last_update_by   sys_dept_last_update_by,
               sys_dept.last_update_time sys_dept_last_update_time,
               sys_dept.del_flag         sys_dept_del_flag,
               sys_role.id               sys_role_id,
               sys_role.name             sys_role_name,
               sys_role.remark           sys_role_remark,
               sys_role.create_by        sys_role_create_by,
               sys_role.create_time      sys_role_create_time,
               sys_role.last_update_by   sys_role_last_update_by,
               sys_role.last_update_time sys_role_last_update_time,
               sys_role.del_flag         sys_role_del_flag,
               sys_menu.id               sys_menu_id,
               sys_menu.name             sys_menu_name,
               sys_menu.parent_id        sys_menu_parent_id,
               sys_menu.url              sys_menu_url,
               sys_menu.perms            sys_menu_perms,
               sys_menu.type             sys_menu_type,
               sys_menu.icon             sys_menu_icon,
               sys_menu.order_num        sys_menu_order_num,
               sys_menu.create_by        sys_menu_create_by,
               sys_menu.create_time      sys_menu_create_time,
               sys_menu.last_update_by   sys_menu_last_update_by,
               sys_menu.last_update_time sys_menu_last_update_time,
               sys_menu.del_flag         sys_menu_del_flag,
               sys_menu.endpoint         sys_menu_endpoint
        from sys_user sys_user
                 left join sys_dept sys_dept
                           on sys_user.dept_id = sys_dept.id
                 left join sys_user_role on sys_user_role.user_id = sys_user.id
                 left join sys_role sys_role on sys_role.id = sys_user_role.role_id
                 left join sys_role_menu sys_role_menu on sys_role_menu.role_id = sys_role.id
                 left join sys_menu sys_menu on sys_menu.id = sys_role_menu.menu_id
    </sql>
    <sql id="selectIds">
        select distinct sys_user.id sys_user_id
        from sys_user sys_user
                 left join sys_dept sys_dept
                           on sys_user.dept_id = sys_dept.id
                 left join sys_user_role on sys_user_role.user_id = sys_user.id
                 left join sys_role sys_role on sys_role.id = sys_user_role.role_id
                 left join sys_role_menu sys_role_menu on sys_role_menu.role_id = sys_role.id
                 left join sys_menu sys_menu on sys_menu.id = sys_role_menu.menu_id
    </sql>
    <sql id="where">
        where sys_user.del_flag = 0
        <trim>
            <if test="query.name!=null and query.name!=''">
                and sys_user.name like concat('%',#{query.name},'%')
            </if>
            <if test="query.nickName!=null and query.nickName!=''">
                and sys_user.nick_name like concat('%',#{query.nickName},'%')
            </if>
            <if test="query.email!=null and query.email!=''">
                and sys_user.email like concat('%',#{query.email},'%')
            </if>
            <if test="query.mobile!=null and query.mobile!=''">
                and sys_user.mobile like concat('%',#{query.mobile},'%')
            </if>
            <if test="query.userType!=null">
                and sys_user.user_type=#{query.userType}
            </if>
            <if test="query.status!=null">
                and sys_user.status = #{query.status}
            </if>
            <if test="query.deptId!=null and query.deptId!=''">
                and sys_user.dept_id = #{query.deptId}
            </if>
            <if test="query.ids!=null and query.ids.size()>0">
                and sys_user.sys_user_id in
                <foreach collection="query.ids" separator="," item="id" open="(" close=")">
                    #{id}
                </foreach>
            </if>
        </trim>
    </sql>
    <resultMap id="user" type="icu.liuwisdom.admin.entity.SysUser">
        <id column="sys_user_id" property="id"/>
        <result column="sys_user_name" property="name"/>
        <result column="sys_user_nick_name" property="nickName"/>
        <result column="sys_user_avatar" property="avatar"/>
        <result column="sys_user_password" property="password"/>
        <result column="sys_user_salt" property="salt"/>
        <result column="sys_user_email" property="email"/>
        <result column="sys_user_mobile" property="mobile"/>
        <result column="sys_user_status" property="status"/>
        <result column="sys_user_dept_id" property="deptId"/>
        <result column="sys_user_create_by" property="createBy"/>
        <result column="sys_user_create_time" property="createTime"/>
        <result column="sys_user_last_update_by" property="lastUpdateBy"/>
        <result column="sys_user_last_update_time" property="lastUpdateTime"/>
        <result column="sys_user_del_flag" property="delFlag"/>
        <result column="sys_user_user_type" property="userType"/>
    </resultMap>
    <resultMap id="userVo" type="icu.liuwisdom.admin.vo.SysUserVo" extends="user">
        <result property="deptName" column="sys_dept_name"/>
        <association property="dept" javaType="icu.liuwisdom.admin.entity.SysDept">
            <id property="id" column="sys_dept_id"/>
            <result property="name" column="sys_dept_name"/>
            <result property="parentId" column="sys_dept_parent_id"/>
            <result property="orderNum" column="sys_dept_order_num"/>
            <result property="createBy" column="sys_dept_create_by"/>
            <result property="createTime" column="sys_dept_create_time"/>
            <result property="lastUpdateBy" column="sys_dept_last_update_by"/>
            <result property="lastUpdateTime" column="sys_dept_last_update_time"/>
            <result property="delFlag" column="sys_dept_del_flag"/>
        </association>
        <collection property="userRoles" ofType="icu.liuwisdom.admin.entity.SysRole">
            <id property="id" column="sys_role_id"/>
            <result property="name" column="sys_role_name"/>
            <result property="remark" column="sys_role_remark"/>
            <result property="createBy" column="sys_role_create_by"/>
            <result property="createTime" column="sys_role_create_time"/>
            <result property="lastUpdateBy" column="sys_role_last_update_by"/>
            <result property="lastUpdateTime" column="sys_role_last_update_time"/>
            <result property="delFlag" column="sys_role_del_flag"/>
        </collection>
        <collection property="sysMenu" ofType="icu.liuwisdom.admin.entity.SysMenu">
            <id property="id" column="sys_menu_id"/>
            <result property="name" column="sys_menu_name"/>
            <result property="parentId" column="sys_menu_parent_id"/>
            <result property="url" column="sys_menu_url"/>
            <result property="perms" column="sys_menu_perms"/>
            <result property="type" column="sys_menu_type"/>
            <result property="icon" column="sys_menu_icon"/>
            <result property="orderNum" column="sys_menu_order_num"/>
            <result property="createBy" column="sys_menu_create_by"/>
            <result property="createTime" column="sys_menu_create_time"/>
            <result property="lastUpdateBy" column="sys_menu_last_update_by"/>
            <result property="lastUpdateTime" column="sys_menu_last_update_time"/>
            <result property="delFlag" column="sys_menu_del_flag"/>
            <result property="endpoint" column="sys_menu_endpoint"/>
        </collection>
    </resultMap>
    <!--通过用户名查询用户所有信息-->
    <select id="selectByName" resultMap="userVo">
        <include refid="select"/>
        where sys_user.name = #{name} and sys_user.del_flag = 0
    </select>
    <!--分页查询-->
    <select id="selectIds" resultType="java.lang.String">
        <include refid="selectIds"/>
        <include refid="where"/>
    </select>
    <select id="basePage" resultMap="userVo">
        <include refid="select"/>
        <include refid="where"/>
    </select>
    <select id="selectById" resultMap="userVo">
        <include refid="select"/>
        where sys_user.id = #{id} and sys_user.del_flag = 0
    </select>
</mapper>
