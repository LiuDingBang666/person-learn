<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="icu.liuwisdom.admin.mapper.SysDeptMapper">
    <sql id="select">
        select sys_dept.id                    sys_dept_id,
               sys_dept.name                  sys_dept_name,
               sys_dept.parent_id             sys_dept_parent_id,
               sys_dept.order_num             sys_dept_order_num,
               sys_dept.create_by             sys_dept_create_by,
               sys_dept.create_time           sys_dept_create_time,
               sys_dept.last_update_by        sys_dept_last_update_by,
               sys_dept.last_update_time      sys_dept_last_update_time,
               sys_dept.del_flag              sys_dept_del_flag,
               sys_dept2.name                 sys_dept2_name,
               sys_role_dept.id               sys_role_dept_id,
               sys_role_dept.role_id          sys_role_dept_role_id,
               sys_role_dept.dept_id          sys_role_dept_dept_id,
               sys_role_dept.create_by        sys_role_dept_create_by,
               sys_role_dept.create_time      sys_role_dept_create_time,
               sys_role_dept.last_update_by   sys_role_dept_last_update_by,
               sys_role_dept.last_update_time sys_role_dept_last_update_time,
               sys_role.id                    sys_role_id,
               sys_role.name                  sys_role_name,
               sys_role.remark                sys_role_remark,
               sys_role.create_by             sys_role_create_by,
               sys_role.create_time           sys_role_create_time,
               sys_role.last_update_by        sys_role_last_update_by,
               sys_role.last_update_time      sys_role_last_update_time,
               sys_role.del_flag              sys_role_del_flag
        from sys_dept sys_dept
                 left join sys_dept sys_dept2 on sys_dept2.parent_id = sys_dept.id
                 left join sys_role_dept sys_role_dept on sys_role_dept.dept_id = sys_dept.id
                 left join sys_role sys_role on sys_role.id = sys_role_dept.role_id
    </sql>
    <sql id="selectIds">
        select distinct sys_dept.id sys_dept_id
        from sys_dept sys_dept
                 left join sys_dept sys_dept2 on sys_dept2.parent_id = sys_dept.id
                 left join sys_role_dept sys_role_dept on sys_role_dept.dept_id = sys_dept.id
    </sql>
    <sql id="where">
        where sys_dept.del_flag = 0
        <trim>
            <if test="query.name!=null and query.name!=''">
                and sys_dept.name like concat('%',#{query.name},'%')
            </if>
            <if test="query.ids!=null and query.ids.size()>0">
                and sys_dept.sys_dept_id in
                <foreach collection="query.ids" separator="," item="id" open="(" close=")">
                    #{id}
                </foreach>
            </if>
        </trim>

    </sql>
    <resultMap id="po" type="icu.liuwisdom.admin.entity.SysDept">
        <id property="id" column="sys_dept_id"/>
        <result property="name" column="sys_dept_name"/>
        <result property="parentId" column="sys_dept_parent_id"/>
        <result property="orderNum" column="sys_dept_order_num"/>
        <result property="createBy" column="sys_dept_create_by"/>
        <result property="createTime" column="sys_dept_create_time"/>
        <result property="lastUpdateBy" column="sys_dept_last_update_by"/>
        <result property="lastUpdateTime" column="sys_dept_last_update_time"/>
        <result property="delFlag" column="sys_dept_del_flag"/>
    </resultMap>
    <resultMap id="vo" type="icu.liuwisdom.admin.vo.SysDeptVo" extends="po">
        <result property="parentName" column="sys_dept2_name"/>
        <collection property="sysRole" ofType="icu.liuwisdom.admin.entity.SysRole">
            <id property="id" column="sys_role_id"/>
            <result property="name" column="sys_role_name"/>
            <result property="remark" column="sys_role_remark"/>
            <result property="createBy" column="sys_role_create_by"/>
            <result property="createTime" column="sys_role_create_time"/>
            <result property="lastUpdateBy" column="sys_role_last_update_by"/>
            <result property="lastUpdateTime" column="sys_role_last_update_time"/>
            <result property="delFlag" column="sys_role_del_flag"/>
        </collection>
    </resultMap>
    <!--分页查询-->
    <select id="selectIds" resultType="java.lang.String">
        <include refid="selectIds"/>
        <include refid="where"/>
    </select>
    <select id="basePage" resultMap="vo">
        <include refid="select"/>
        <include refid="where"/>
        order by sys_dept_order_num
    </select>
    <select id="selectById" resultMap="vo">
        <include refid="select"/>
        where sys_dept.id = #{id} and sys_dept.del_flag=0
    </select>
</mapper>
